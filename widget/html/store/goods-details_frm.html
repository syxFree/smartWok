<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=0, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>资讯详情</title>
    <link rel="stylesheet" href="../../css/api.css">
    <style>
        html,body{
            width: 100%;
            height: 100%;
            /* overflow: hidden; */
        }
        .app{
            width: 100%;
            height: 100%;
            background-color: #F7F7F7;
        }
        section{
          height: 100%;
        }
        .header{
            width: 90%;
            height: .6rem;
            position: absolute;;
            top: .7rem;
            left: 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            /*box-sizing: border-box;
            padding: 0 .2rem;*/
            z-index: 9999;
        }
        .header img{
            width: .54rem;
            height: .54rem;
        }
        .swiper{
            width: 100%;
            height: 7.5rem;
            position: relative;
            overflow: hidden;
            display: flex;
        }
        .swiper img{
            width: 100%;
            height: 100%;
        }
        .goods-describe{
            width: 100%;
            height: 2rem;
            /*margin-top: 7.5rem;*/
            background-color: white;
            /*box-sizing:content-box;*/
            /*padding: .2rem;*/
            position: relative;
        }
        .goods-describe .info{
            width: 90%;
            /*height: 40px;*/
            margin-bottom: .2rem;
            color: #333;
            font-size: .32rem;
            overflow:hidden;
            text-overflow:ellipsis;
            display:-webkit-box;
            -webkit-box-orient:vertical;
            -webkit-line-clamp:2;
            position: relative;
            padding-top: .3rem;
            padding-left: .3rem;
        }
        .goods-describe .goods-price-count{
          text-align: justify;
            width: 100%;
            height: .5rem;
            /*margin-top: .15rem;*/
            display: flex;
            justify-content: space-between;
            position: absolute;
            bottom: .2rem;
        }
        .goods-price-count .good-price{
            color: #FF8C46;
            font-size: .36rem;
            position: relative;
            left: .3rem
        }
        .goods-price-count .good-count{
            color: #999;
            font-size: .28rem;
            position: relative;
            left: -.2rem;
        }
        .detail{
            width: 100%;
            background-color: white;
            margin-top: .2rem;
            margin-bottom: 0.5rem;
            line-height: 1.2rem;
            font-size: .3rem;
        }
        .detail p{
            width: 1.2rem;
            height: 0.76rem;
            margin-left: .3rem;
            border-bottom: 4px solid #FF8C46;
            margin-bottom: .5rem;
        }
        .detail img{
            width: 100%;
            height: 9rem;
        }
        footer{
            width: 100%;
            height: .98rem;
            background-color: white;
            position: fixed;
            bottom: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-around;
            /*box-sizing: border-box;
            padding: 0 .2rem;*/
        }
        footer .makeCall{
            width: .5rem;
            height: .8rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .makeCall img{
            width: .4rem;
        }
        footer .order{
            width: 6rem;
            height: .78rem;
            border-radius: .78rem;
            background-color: #FF8C46;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: .32rem;
        }
        .shade{
            width: 100%;
            height: 100%;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            background-color: rgba(0, 0, 0, .6);
        }
        .choose{
            width: 100%;
            height: 5.09rem;
            background-color: white;
            position: absolute;
            bottom: 0;
            border-radius: .2rem .2rem 0 0;
        }
        .choose .close-img{
            width: .3rem;
            height: .3rem;
            position: absolute;
            right: .3rem;
            top: .3rem;
        }
        .close-img img{
            width: 100%;
            height: 100%;
        }
        .choose .goods-info{
            width: 90%;
            height: 2rem;
            margin-top: .6rem;
            position: relative;
            left: .3rem;
            /* box-sizing: border-box;
            padding: 0 .3rem; */
            display: flex;
        }
        .goods-info img{
            width: 2rem;
            height: 2rem;
        }
        .goods-info .info-price-count{
            width: 2rem;
            height: 50%;
            margin-left: .2rem;
            margin-top: 1.05rem;
        }
        .info-price-count p:nth-of-type(1){
            color: #FF8C46;
            font-size: .36rem;
        }
        .info-price-count p:nth-of-type(2){
            color: #999999;
            font-size: .28rem;
            margin-top: .08rem;
        }
        .choose .order-count{
            width: 90%;
            height: .6rem;
            line-height: .6rem;
            margin: .4rem auto;
            display: flex;
            justify-content: space-between;
            font-size: .3rem;
            color: #333;
        }
        .order-count .order-operate{
            width: 1.7rem;
            height: .52rem;
            display: flex;
            justify-content: space-between;
        }
        .order-count .order-operate img,
        .order-count .order-operate .count
        {
            width: .52rem;
            height: .52rem;
            text-align: center;
            ;line-height: .52rem;
        }
        .order-btn{
            width: 6.9rem;
            height: .78rem;
            background-color: #FF8C46;
            border-radius: .78rem;
            color: white;
            font-size: .32rem;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            bottom: .1rem;
            left: 4%;
        }
        #shade{
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, .6);
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1000;
            /*display: none;*/
            color: #333;
        }
          #shade .content{
            width: 100%;
            height: 2.2rem;
            position: fixed;
            bottom: 0;
            background-color: white;
            display: flex;
            align-items: center;
        }
          #shade .share-img{
            width: 1.7rem;
            height: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-direction: column;
            font-size: .26rem;
            color: #333!important;
        }
          #shade .share-img img{
            width: .9rem;
            height: .9rem;
        }
        .circle{
          /*width: 1rem;*/
          height: .6rem;
          display: flex;
          justify-content: space-around;
          align-items: center;
          position: absolute;
          bottom: 0rem;
          left: 50%;
          transform: translateX(-50%);
        }
        .circleItem{
          width: .14rem;
          height: .14rem;
          margin: 0 .1rem;
          border-radius: 50%;
          background-color: white;
        }
        .circleItemActive{
          width: .14rem;
          height: .14rem;
          border-radius: 50%;
          background-color: rgb(0,0,0);
        }
    </style>
</head>
<body>
    <div class="app">
        <section>
            <div class="header">
                <div class="back" @click="back">
                    <img src="../../image/store/goods-back.png" alt="返回">
                </div>
                <div class="share" @click="share">
                    <img src="../../image/store/goods-share.png" alt="分享">
                </div>
            </div>
            <div class="swiper">
                <img :src="img[currentIndex]" alt="轮播图">
                <!-- <img :src="item" v-for="item in img" alt="轮播图"> -->
                <div class="circle">
                    <div :class="currentIndex==index?'circleItemActive':'circleItem'" v-for="(item,index) in img.length" @click="currentIndex=index"></div>
                </div>
            </div>
            <div class="goods-describe">
                <div class="info" v-html="goods.desc">{{goods.desc}}</div>
                <div class="goods-price-count">
                    <div class="good-price">￥{{goods.price}}</div>
                    <div class="good-count">库存：{{goods.stock}}</div>
                </div>
            </div>
            <div class="detail">
                <p>商品详情</p>
                <img :src="item" alt="" v-for="(item, index) in img" :key="index">
            </div>
        </section>
        <footer>
            <div class="makeCall" @click="call">
                <img src="../../image/store/makeCall.png" alt="联系">
                <span>联系</span>
            </div>
            <div class="order" @click="order">立即购买</div>
        </footer>
        <div class="shade" v-if="shadeFlag">
            <div class="choose">
                <div class="close-img" @click="closeShade">
                    <img src="../../image/store/store-close.png" alt="关闭">
                </div>
                <div class="goods-info">
                    <img :src="img[0]" alt="商品图片">
                    <div class="info-price-count">
                        <p>￥{{goods.price}}</p>
                        <p>库存：{{goods.stock}}</p>
                    </div>
                </div>
                <div class="order-count">
                    <span>数量</span>
                    <div class="order-operate">
                        <img v-if="delFlag" src="../../image/store/delActive.png" alt="" @click="del">
                        <img v-else src="../../image/store/del.png" alt="" @click=del>
                        <div class="count">{{orderCount}}</div>
                        <img v-if="incFlag" src="../../image/store/incActive.png" alt="" @click="inc">
                        <img v-else src="../../image/store/inc.png" alt="" @click=inc>
                    </div>
                </div>
                <div class="order-btn" @click="goOrderSubmit">确定</div>
            </div>
        </div>
        <div id="shade" @click="cancel" v-if="shadeFlag2">
            <div class="content">
                <div class="share-img" @click.stop="shareWx">
                    <img src="../../image/information/share_wx.png" alt="">
                    微信好友
                </div>
                <div class="share-img" @click.stop="shareFriend">
                     <img src="../../image/information/share_friend.png" alt="">
                     朋友圈
                </div>
            </div>
        </div>
    </div>
    <script src="../../script/api.js"></script>
    <script src="../../script/flexible.js"></script>
    <script src="../../script/vue.min.js"></script>
    <script src="../../script/restful.js" charset="utf-8"></script>
    <script>
    apiready=function(){
      var id=api.pageParam.id
      console.log(id)
        var vm=new Vue({
            el:'.app',
            data:{
                //商品信息
                goods:{
                    swiper:'../../image/store/five.jpg',
                    details:'暮厨不锈钢炒锅炒菜过32厘米无涂层少油烟304燃气 国美厨空间（32cm）暮厨不锈钢炒锅炒菜过32厘米无涂层少油烟304燃气 国美厨空间（32cm）',
                    price:'368.90',
                    amount:666,
                    detailImg1:'../../image/store/six.png',
                    detailImg2:'../../image/store/seven.png'
                },
                orderCount:1,   //购买数量
                delFlag:false,   //删除按钮的状态
                incFlag:true,   //增加按钮的状态
                shadeFlag:false,  //遮罩层状态
                shadeFlag2:false,
                img:[],
                currentIndex:0,
                phone:'123456789123'
            },
            created(){
                this.getData()
                this.getCall()
            },
            watch: {
                //监听数量的加减，改版加减数量按钮的状态
                orderCount:function(){
                    if(this.orderCount<=1){
                        this.delFlag=false
                    }
                    else{
                        this.delFlag=true
                    }
                    if(this.orderCount>=this.goods.amount){
                        this.incFlag=false
                    }
                    else{
                        this.incFlag=true
                    }
                }
            },
            methods: {
                //返回按钮
                back:function(){
                  api.closeWin()
                },
                getData:function(){
                  var vm=this
                  var params={
                    id:id
                  }
                  fnGet(interfaces.goodsDetails,params,true,function(ret,err){
                    if(ret.code==RESPONSE_OK){
                      vm.goods=ret.data
                      var bannerList=vm.goods.images.split(',')
                      vm.img=bannerList
                      vm.moveSlide()
                      api.openFrame({
                          name: 'header_frm',
                          url: 'header_frm.html',
                          rect: {
                              x: 0,
                              y: api.winWidth/2,
                              w: 320,
                              h: 480
                          },
                          pageParam: {
                              name: 'test'
                          },
                          bounces: true,
                          bgColor: 'red',
                          vScrollBarEnabled: true,
                          hScrollBarEnabled: true
                      });
                    }else{
                      api.toast({
                          msg: ret.msg,
                          duration: 2000,
                          location: 'bottom'
                      });

                    }
                  })
                },
                getCall:function(){
                    var vm=this
                    fnGet(interfaces.call,{},true,function(ret,err){
                        if(ret.code==RESPONSE_OK){
                          vm.phone=ret.data
                        }
                        else{
                          api.toast({
                              msg: ret.msg,
                              duration: 2000,
                              location: 'bottom'
                          });
                        }
                    })
                },
                //分享按钮
                share:function(){
                  this.shadeFlag2=true
                  document.body.addEventListener('touchmove', this.scroll
                  , {passive:false});
                },
                cancel:function(){
                    this.shadeFlag2=false
                    document.body.removeEventListener('touchmove', this.scroll
                    ,{passive:false});
                },
                shareWx:function(){
                    alert("分享到微信")
                },
                shareFriend:function(){
                    alert("分享到朋友圈")
                },
                //联系按钮
                call:function(){
                  var vm=this
                    api.confirm({
                        // title: 'title',
                        msg: vm.phone,
                        buttons:['拨打', '取消']
                    },function(ret,err){
                        if(ret.buttonIndex == 1){
                          api.call({
                              type: 'tel_prompt',
                              number: vm.phone //商家电话
                          });
                        }else{
                          api.toast({
                              msg: '您取消了拨号',
                              duration: 2000,
                              location: 'bottom'
                          });
                        }
                    });

                },
                //购买按钮
                order:function(){
                    //添加禁止页面滚动
                    this.shadeFlag=true
                    document.body.addEventListener('touchmove', this.scroll
                    , {passive:false});
                },
                //关闭遮罩层
                closeShade:function(){
                    this.shadeFlag=false
                    document.body.removeEventListener('touchmove', this.scroll
                    ,{passive:false});
                },
                //禁止滚动事件
                scroll:function(e){
                    e.preventDefault();
                },
                //点击增加数量
                inc:function(){
                    if(this.incFlag){
                        console.log("jia")
                        this.orderCount++
                    }
                    else{
                        return
                    }
                },
                //点击减少数量
                del:function(){
                    if(this.delFlag){
                        console.log("减")
                        this.orderCount--
                    }
                    else{
                        return
                    }
                },
                //跳转到提交订单页
                goOrderSubmit:function(){
                    var goodsInfo=this.goods
                    goodsInfo.count=this.orderCount
                    goodsInfo.img=this.img[0]
                    console.log(JSON.stringify(goodsInfo))
                    api.openWin({
                        name: 'orderSubmit',
                        url: '../order_submit/orderSubmit_win.html',
                        reload:true,
                        bounces:false,
                        slidBackEnabled:false,
                        pageParam: {
                            goodsInfo:goodsInfo
                        }
                    });
                },
                //左右滑动手势
                moveSlide() {
                    var vm = this;
                    clearInterval(timer)
                    var timer=setInterval(function(){
                        if(vm.currentIndex==vm.img.length-1){
                          vm.currentIndex=0
                        }
                        else{
                            vm.currentIndex++
                        }
                    },3000)
                    this.$nextTick(function () {
                        //侧滑显示删除按钮
                        var container = document.querySelectorAll('.swiper img');
                        console.log(container)
                        console.log(JSON.stringify(container))
                        for (var i = 0; i < container.length; i++) {
                            var x, y, X, Y, swipeX, swipeY;
                            container[i].addEventListener('touchstart', function (event) {
                                x = event.changedTouches[0].pageX;
                                y = event.changedTouches[0].pageY;
                                swipeX = true;
                                swipeY = true;
                                // setInterval(timer)
                            });
                            container[i].addEventListener('touchmove', function (event) {
                                X = event.changedTouches[0].pageX;
                                Y = event.changedTouches[0].pageY;
                                // clearInterval(timer)
                                // 左右滑动
                                if (swipeX && Math.abs(X - x) - Math.abs(Y - y) > 0) {
                                    // 阻止事件冒泡
                                    event.stopPropagation();
                                    if (X - x > 10) {   //右滑
                                      if(vm.currentIndex>=vm.img.length-1){
                                          return
                                      }
                                      console.log(X-x)
                                      vm.currentIndex++
                                      // document.getElementsByClassName("swiper")[0].style.transform='translateX(100%)'
                                      // document.getElementsByClassName("swiper")[0].style.transition='all .5s ease'
                                    }
                                    if (x - X > 10) {   //左滑
                                      if(vm.currentIndex<=0){
                                          return
                                      }
                                      console.log("向左滑动事件")
                                      vm.currentIndex--
                                      // document.getElementsByClassName("swiper")[0].style.transform='translateX(-100%)'
                                      // document.getElementsByClassName("swiper")[0].style.transition='all .5s ease'
                                    }
                                    swipeX = false;
                                }
                            });
                        }
                    })
                },
                banner:function(){
                  var vm=this
                  var bannerList=vm.goods.images.split(',')
                  vm.img=bannerList
                  console.log(JSON.stringify(bannerList))
                  var UIScrollPicture = api.require('UIScrollPicture');
                  UIScrollPicture.open({
                      rect: {
                          x: 0,
                          y: 0,
                          w: api.winWidth,
                          h: api.winHeight/2
                      },
                      data: {
                          paths: bannerList,
                          //对图片的描述，可写可不写
                          // captions: wordList
                      },
                      //文字样式
                      styles: {
                          caption: {
                              height: 30,
                              color: '#E0FFFF',
                              size: 15,
                              bgColor: 'rgba(0, 0, 0, .6)',
                              position: 'bottom'
                          },
                          indicator: {
                          //圆点样式
                          dot:{
                              w:7,
                              h:7,
                              r:3,
                              margin:10
                          },
                              align: 'center',
                              color: '#000000',
                              activeColor: 'rgba(0,0,0,.4)'
                          }
                      },
                      placeholderImg: 'widget://res/slide1.jpg',
                      contentMode: 'scaleToFill',
                      //切换的时间
                      interval: 3,
                      fixedOn: api.frameName,
                      loop: true,
                      fixed: false
                  }, function(ret, err) {
                      if (ret) {

                      } else {
                          alert(JSON.stringify(err));
                      }
                  });
                }
            },
        })
      }
    </script>
</body>
</html>
